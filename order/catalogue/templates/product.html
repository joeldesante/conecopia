{% extends "master-catalogue.html" %}

{% load static %}

{% load humanize %}
{% load filters %}

{% block title %}
    {{ product.name }} Gelato
{% endblock %}

{% block content %}
<nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs">
    <ul>
        <li><a href="/order">Conecopia's Menu</a></li>
        <li class="is-active"><a href="#" aria-current="page">{{ product.name }}</a></li>
    </ul>
</nav>


<div class="flex flex-row gap-8 justify-center">
    
    <!-- Slider -->
    <div data-hs-carousel='{
        "loadingClasses": "opacity-0"
    }' class="relative">
        <div class="hs-carousel flex space-x-2">
            <div class="flex-none">
                <div class="hs-carousel-pagination max-h-[625px] flex flex-col gap-y-2 overflow-y-auto">
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-100 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">First slide</span>
                    </div>
                    </div>
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-200 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">Second slide</span>
                    </div>
                    </div>
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-300 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">Third slide</span>
                    </div>
                    </div>
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-100 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">Fourth slide</span>
                    </div>
                    </div>
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-200 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">Fifth slide</span>
                    </div>
                    </div>
                    <div class="hs-carousel-pagination-item shrink-0 border rounded-md overflow-hidden cursor-pointer w-[75px] h-[75px] hs-carousel-active:border-blue-400">
                    <div class="flex justify-center h-full bg-gray-300 p-2">
                        <span class="self-center text-xs text-gray-800 transition duration-700">Sixth slide</span>
                    </div>
                    </div>
                </div>
            </div>

            <div class="relative grow overflow-hidden min-h-[625px] min-w-[425px] bg-white rounded-lg">
                
                <div class="hs-carousel-body absolute top-0 bottom-0 start-0 flex flex-nowrap transition-transform duration-700 opacity-0">
                
                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full p-6 bg-cover" style="background-image: url('{% static 'sample.jpg' %}')">
                            <span 
                                class="self-center transition duration-700">
                            </span>
                        </div>
                    </div>

                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full bg-gray-200 p-6">
                            <span class="self-center text-4xl text-gray-800 transition duration-700">Second slide</span>
                        </div>
                    </div>

                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full bg-gray-300 p-6">
                            <span class="self-center text-4xl text-gray-800 transition duration-700">Third slide</span>
                        </div>
                    </div>
                    
                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full bg-gray-100 p-6">
                            <span class="self-center text-4xl text-gray-800 transition duration-700">Fourth slide</span>
                        </div>
                    </div>
                    
                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full bg-gray-200 p-6">
                            <span class="self-center text-4xl text-gray-800 transition duration-700">Fifth slide</span>
                        </div>
                    </div>
                    
                    <div class="hs-carousel-slide">
                        <div class="flex justify-center h-full bg-gray-300 p-6">
                            <span class="self-center text-4xl text-gray-800 transition duration-700">Sixth slide</span>
                        </div>
                    </div>
                </div>

                <button type="button" class="hs-carousel-prev hs-carousel-disabled:opacity-50 hs-carousel-disabled:pointer-events-none absolute inset-y-0 start-0 inline-flex justify-center items-center w-[46px] h-full text-gray-800 hover:bg-gray-800/10 focus:outline-none focus:bg-gray-800/10 rounded-s-lg">
                    <span class="text-2xl" aria-hidden="true">
                        <svg class="shrink-0 size-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m15 18-6-6 6-6"></path>
                        </svg>
                    </span>
                    <span class="sr-only">Previous</span>
                </button>
            
                <button type="button" class="hs-carousel-next hs-carousel-disabled:opacity-50 hs-carousel-disabled:pointer-events-none absolute inset-y-0 end-0 inline-flex justify-center items-center w-[46px] h-full text-gray-800 hover:bg-gray-800/10 focus:outline-none focus:bg-gray-800/10 rounded-e-lg">
                    <span class="sr-only">Next</span>
                    <span class="text-2xl" aria-hidden="true">
                        <svg class="shrink-0 size-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m9 18 6-6-6-6"></path>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <!-- End Slider -->

    <div class="flex flex-col gap-4">
        <section>
            <h1 class="text-2xl font-semibold">{{ product.name }}</h1>
            <p><span class="font-medium">${{ product.price|divide:100|floatformat:2|intcomma }}</span> <span class="text-neutral-600">/ Pint</span></p>
        </section>

        <article>
            <p>{{ product.description }}</p>
        </article>

        <section>
            <h4 class="text-lg font-medium">Ingredients</h4>
            <ul>
                <li>Whole Milk</li>
                <li>Cream</li>
                <li>Cane Sugar</li>
                <li>Egg Yolks</li>
                <li>Raspberries</li>
            </ul>
        </section>

        <section class="flex flex-row gap-4">
            <div class="control">
                <button id="quantity-subtract" class="button">-</button>
                <input class="input" type="number" value="1" min="1" max="99" id="quantity" />
                <button id="quantity-add" class="button">+</button>
            </div>
            <button id="add-to-cart" type="button" class="py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none">
                Add to Cart
                <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m5 11 4-7"></path>
                    <path d="m19 11-4-7"></path>
                    <path d="M2 11h20"></path>
                    <path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8c.9 0 1.8-.7 2-1.6l1.7-7.4"></path>
                    <path d="m9 11 1 9"></path>
                    <path d="M4.5 15.5h15"></path>
                    <path d="m15 11-1 9"></path>
                </svg>
            </button>
        </section>
    </div>
</div>

<script>
    const quantityInput = document.getElementById("quantity");
    const addToCartButton = document.getElementById("add-to-cart");
    const quantityAdd = document.getElementById("quantity-add");
    const quantitySubtract = document.getElementById("quantity-subtract");

    function addToNumberInputValue(input, valueToAdd) {
        if(input.type != "number") { throw new Error(`Invalid input type of ${input.type}. Expected 'number'.`); }
        input.value = parseInt(input.value) + valueToAdd
    }

    function clampNumberInput(input, min, max) {
        if(input.type != "number") { throw new Error(`Invalid input type of ${input.type}. Expected 'number'.`); }
        if(parseInt(input.value) < min) { input.value = min }
        if(parseInt(input.value) > max) { input.value = max }
    }

    quantityAdd.onclick = () => { 
        addToNumberInputValue(quantityInput, 1);
        clampNumberInput(quantityInput, 1, 99);
    }
    
    quantitySubtract.onclick = () => { 
        addToNumberInputValue(quantityInput, -1);
        clampNumberInput(quantityInput, 1, 99);
    }

    quantityInput.oninput = () => clampNumberInput(quantityInput, 0, 99);

    addToCartButton.onclick = () => {
        // 1. Create a AJAX request to add the item to cart
        const data = new FormData();
        data.append("csrfmiddlewaretoken", "{{ csrf_token }}");
        data.append("product_id", "{{ product.id }}");
        data.append("quantity", quantityInput.value);

        addToCartButton.disabled = true;
        addToCartButton.classList.add("is-loading");

        const addToCartRequest = fetch("/order/functions/add_product_to_cart", {
            method: "POST",
            body: data
        }).then((response) => {
            // 2. If the AJAX request succeeds (200 OK) then redirect the user to /order
            if(!response.ok) {
                throw new Error(response.statusText);
            }
            window.location.href = "/order"
        }).catch((err) => {
            // 3. Otherwise notify the user of the error
            console.warn(err)
        }).finally(() => {
            addToCartButton.classList.remove("is-loading");
            addToCartButton.disabled = false;
        });

    }
</script>
{% endblock content %}