{% extends "master-catalogue.html" %}

{% block title %}Checkout{% endblock title %}

{% block content %}

<nav class="breadcrumb has-succeeds-separator" aria-label="breadcrumbs">
    <ul>
        <li><a href="/order">Conecopia's Menu</a></li>
        <li class="is-active"><a href="#" aria-current="page">Checkout</a></li>
    </ul>
</nav>

<ol class="flex items-center whitespace-nowrap mb-4">
    <li class="inline-flex items-center">
        <a class="flex items-center text-sm text-gray-500 hover:text-blue-600 focus:outline-none focus:text-blue-600" href="/order">
            Conecopia's Menu
        </a>

        <svg class="shrink-0 mx-2 size-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m9 18 6-6-6-6"></path>
        </svg>
        
    </li>
    <li class="inline-flex items-center text-sm font-semibold text-gray-800 truncate" aria-current="page">
        Checkout
    </li>
</ol>

<h1>Checkout</h1>
<div id="bill-element"></div>
<div id="pay-element"></div>

<button class="button is-primary" id="confirm">Checkout</button>

<script>
    var stripe = Stripe('pk_test_51QUwDHCjQ55y9LkRihf15CeUEOjj3F1YSEGdbI0vVCrRmTMqYv328SRIMbqHfsoeIDXMkuGlyvCvbsQPgkBVtwvB00W1jvzaHo');

    var elements = stripe.elements({
        clientSecret: '{{client_secret}}',
    });

    var paymentElement = elements.create('payment');
    var billingAddressElement = elements.create('address', {
        mode: 'billing',
        fields: {
            phone: 'always'
        },
        validation: {
            phone: {
                required: 'always'
            }
        }
    });

    paymentElement.mount("#pay-element")
    billingAddressElement.mount("#bill-element")

    document.getElementById("confirm").onclick = () => {
        stripe.confirmPayment({
            elements,
            confirmParams: {
                // Return URL where the customer should be redirected after the PaymentIntent is confirmed.
                return_url: 'https://example.com',
            },
        })
        .then(function(result) {
            if (result.error) {
                // Inform the customer that there was an error.
            }
        })
    }

</script>
{% endblock content %}