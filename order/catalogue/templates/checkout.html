{% extends "master-catalogue.html" %}

{% block title %}Checkout{% endblock title %}

{% block content %}

<ol class="flex items-center whitespace-nowrap mb-4">
    <li class="inline-flex items-center">
        <a class="flex items-center text-sm text-gray-500 hover:text-blue-600 focus:outline-none focus:text-blue-600" href="/order">
            Conecopia's Menu
        </a>

        <svg class="shrink-0 mx-2 size-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m9 18 6-6-6-6"></path>
        </svg>
        
    </li>
    <li class="inline-flex items-center text-sm font-semibold text-gray-800 truncate" aria-current="page">
        Checkout
    </li>
</ol>

<h1 class="text-2xl font-bold mb-4">Checkout</h1>
<div id="bill-element"></div>
<div id="pay-element"></div>

<button 
    class="mt-4 py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded border border-transparent bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none print:hidden" id="confirm">
    Complete Checkout
</button>

<script>
    var stripe = Stripe('{{ stripe_public_key }}');

    var elements = stripe.elements({
        clientSecret: '{{client_secret}}',
    });

    var paymentElement = elements.create('payment');
    var billingAddressElement = elements.create('address', {
        mode: 'billing',
        fields: {
            phone: 'always'
        },
        validation: {
            phone: {
                required: 'always'
            }
        }
    });

    paymentElement.mount("#pay-element")
    billingAddressElement.mount("#bill-element")

    document.getElementById("confirm").onclick = () => {
        stripe.confirmPayment({
            elements,
            confirmParams: {
                // Return URL where the customer should be redirected after the PaymentIntent is confirmed.
                return_url: 'https://example.com',
            },
        })
        .then(function(result) {
            if (result.error) {
                // Inform the customer that there was an error.
            }
        })
    }

</script>
{% endblock content %}